# 서블릿과 서블릿 컨테이너



## 서블릿(Servlet)

서블릿이란 Java를 통해 Client의 요청을 처리하고 응답하는 자바 프로그램



## 서블릿 컨테이너(Servlet Container)

서블릿의 생성, 초기화, 종료 등의 생명주기 관리를 해주는 것.

WAS(Web Application Server)의 톰캣도 서블릿 컨테이너이다.

서블릿 컨테이너의 역할은 **통신지원, 생명주기 관리, 멀티 스레딩, 선언적인 보완관리, JSP지원**이 있다.



### 생명주기 관리

서블릿의 라이프 사이클을 위해 세가지 메소드 init(), service(), destroy()를 정의한다.

이 메소드들은 서블릿 SDK에 정의되거나 자체적으로 정의된 클래스에 의해 구현된다.

- init
  - 해당 메소드는 서블릿 생명주기 중 초기화 단계에 호출되는 메소드
  - javax.servlet.ServletConfig인터페이스를 구현하는 오브젝트 전달
  - 서블릿이 웹 어플리케이션에서 초기화 매개변수에 접근할 수 있도록 한다.
- service
  - 해당 메소드는 초기화 이후 각 요청마다 호출되는 메소드
  - Init이나 destroy메소드는 서블릿이 생성될때 단 한번만 호출되는데 비해, 요청이 들어올때마다 호출됨
  - 요청에 의해 생성된 스레드들이 service메소드를 호출하게 되고 service메소드는 각 스레드들의 요청에 맞는 적절한 메소드로 전달
- destroy
  - 서블릿 객체가 파괴되어야할 때 호출
  - 해당 서블릿이 가지고 있던 메모리를 해제한다.

### 통신지원

클라이언트에게 요청이 들어오게 되면 서버에서는 아래와 같은 동작들이 수행되어야한다.

- TCP/IP 연결 대기, 소켓 연결
- Http요청 메시지 파싱
- 비즈니스 로직 실행
- Http응답 메시지 생성
- TCP/IP으로 메시지 전송, 소켓 종료

하지만 톰캣는 개발자에게 단지 비즈니스 로직에만 집중할수 있도록 그 외의 작업들을 수행해준다.

URL요청이 들어오게 되면 톰캣에서 요청 메시지를 HttpServletRequest로 생성하고 개발자가 구현한 비즈니스 로직을 수행후 반환되는 응답을 HttpServletResponse를 생성해서 Http응답 메시지로 전송하게 된다.

웹서버와 서블릿 컨테이너의 요청처리를 순서를 중점으로 보자면

1. Http요청

2. 웹 서버는 해당 요청을 서블릿 컨테이너에 전달

3. 서블릿이 컨테이너에 없다면, 서블릿을 동적으로 검색해서 컨테이너 주소 공간에 로드

4. 컨테이너가 서블릿의 init()메소드를 호출하면, 서블릿이 초기화됨(로드시 한번만)

5. 컨테이너가 서블릿의 service()메소드를 호출하여 Http 요청을 처리 후 응답

6. 웹 서버는 동적으로 생성된 결과를 반환

   ![image](https://user-images.githubusercontent.com/57162257/151279521-6a974897-737f-43a9-a8fc-1fe331c0689a.png)

### 멀티스레딩

서블릿 컨테이너는 요청이 들어올때 자바 스레드를 생성해주는데, 이 스레드들은 로드된 서블릿의 service메소드를 통해 요청을 처리하고 처리가 끝나게 되면 자동으로 종료된다.

(다중 처리에 관련해서는 나중에 자세히 작성해야지)

### 선언적인 보안관리

서블릿 컨테이너는 보안 관련된 기능을 지원하므로 서블릿 코드 안에 보안 관련된 메소드를 구현하지 않아도 된다.

### JSP지원

